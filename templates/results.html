<!DOCTYPE html>
<html>
  <head>
    <title>Results</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        .pass {
            color: green;
            font-size: 20px;
        }
        .fail {
            color: red;
            font-size: 20px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script>
      function updateResult(model, promptIndex, pass, checkbox) {
        var loadingIndicator = document.createElement('span');
        loadingIndicator.className = 'loading';
        checkbox.parentNode.appendChild(loadingIndicator);
        checkbox.style.display = 'none';

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/update_result", true);
        xhr.setRequestHeader(
          "Content-type",
          "application/x-www-form-urlencoded",
        );
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            checkbox.style.display = '';
            loadingIndicator.remove();
            // Handle response if needed
          }
        };
        var params =
          "model=" +
          encodeURIComponent(model) +
          "&promptIndex=" +
          promptIndex +
          "&pass=" +
          pass;
        xhr.send(params);
      }
    </script>
  </head>
  <body>
    <h1>Results</h1>
    <table border="1">
      <thead>
        <tr>
          <th>Model</th>
          {{range $index, $prompt := .Prompts}}
          <th>Prompt {{$index + 1}}</th>
          {{end}}
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {{range $model, $results := .Results}}
        <tr>
          <td>{{$model}}</td>
          {{range $index, $pass := $results}}
          <td>
            <input
              type="checkbox"
              {{if $pass}}checked{{end}}
              onchange="updateResult('{{$model}}', {{$index}}, this.checked, this)"
            />
            {{if $pass}}<span class="pass">&#10004;</span>{{else}}<span class="fail">&#10008;</span>{{end}}
          </td>
          {{end}}
          <td>
            {{$total := 0}}
            {{range $pass := $results}}
              {{if $pass}}{{$total = $total + 1}}{{end}}
            {{end}}
            {{$total}}
            <div style="width: 100%; background-color: #f3f3f3; border-radius: 5px; margin-top: 5px;">
                <div style="width: {{$total}}%; background-color: #4CAF50; height: 10px; border-radius: 5px;"></div>
            </div>
          </td>
        </tr>
        {{end}}
      </tbody>
    </table>
    <a href="/prompts">Go to Prompt List</a>
    <h2>Add Model</h2>
    <form action="/add_model" method="post">
        <input type="text" name="model" placeholder="Enter new model name" />
        <input type="submit" value="Add" />
    </form>
    <form action="/reset_results" method="post">
        <input type="submit" value="Reset Results" />
    </form>
    <form action="/export_results" method="post">
        <input type="submit" value="Export Results" />
    </form>
	<form action="/import_results" method="post" enctype="multipart/form-data">
		<input type="file" name="results_file" />
		<input type="submit" value="Import Results" />
	</form>
  </body>
</html>
